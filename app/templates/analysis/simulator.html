{% extends "base.html" %}
{% block title %}Финансовый симулятор · Family Budget{% endblock %}
{% block content %}
<div class="container py-5">
  <div class="row g-4">

    <!-- Вклад: простые / сложные проценты -->
    <div class="col-md-6">
      <div class="fb-card p-4 h-100">
        <h2 class="h5 mb-3">Вклад: простые и сложные проценты</h2>
        <form method="post" class="mb-3">
          <input type="hidden" name="action" value="deposit">
          <div class="mb-2">
            <label class="form-label">Сумма (₽)</label>
            <input type="number" step="0.01" name="principal" class="form-control" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Ставка (% годовых)</label>
            <input type="number" step="0.01" name="rate" class="form-control" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Срок (лет)</label>
            <input type="number" step="0.25" name="years" class="form-control" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Тип процентов</label>
            <select name="interest_kind" class="form-select">
              <option value="simple">Простые (Cn = C0·(1 + n·i))</option>
              <option value="compound" selected>Сложные (Cn = C0·(1 + i/m)^(m·n))</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Начислений в год (m)</label>
            <input type="number" name="periods_per_year" class="form-control" value="1" min="1">
          </div>
          <button type="submit" class="btn btn-fb-primary w-100">
            Посчитать вклад
          </button>
        </form>

        {% if result.deposit %}
          <p class="mb-1">
            Вклад {{ result.deposit.principal }} ₽ под
            {{ "%.2f"|format(result.deposit.rate) }} % на {{ result.deposit.years }} лет.
          </p>
          <p class="mb-1">
            Тип процентов:
            {% if result.deposit.kind == 'simple' %}
              простые.
            {% else %}
              сложные, начислений в год: {{ result.deposit.periods_per_year }}.
            {% endif %}
          </p>
          <p class="mb-0">
            Итоговая сумма:
            <span class="text-income fw-semibold">
              {{ "%.2f"|format(result.deposit.future_value) }} ₽
            </span>
          </p>
        {% endif %}
      </div>
    </div>

    <!-- Эквивалентная и реальная ставка -->
    <div class="col-md-6">
      <div class="fb-card p-4 h-100">
        <h2 class="h5 mb-3">Ставки: эквивалентная и реальная</h2>

        <!-- Эквивалентная годовая ставка -->
        <form method="post" class="mb-3">
          <input type="hidden" name="action" value="equivalent">
          <h3 class="h6 mb-2">Эквивалентная годовая ставка</h3>
          <div class="mb-2">
            <label class="form-label">Номинальная ставка (% годовых)</label>
            <input type="number" step="0.01" name="rate_nominal" class="form-control" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Начислений в год (m)</label>
            <input type="number" name="m" class="form-control" value="1" min="1">
          </div>
          <button type="submit" class="btn btn-fb-outline w-100">
            Посчитать эквивалентную ставку
          </button>
        </form>

        {% if result.equivalent %}
          <p class="mb-2">
            Номинальная ставка {{ "%.2f"|format(result.equivalent.rate_nominal) }} %,
            начислений в год: {{ result.equivalent.m }}.
          </p>
          <p class="mb-3">
            Эквивалентная (эффективная) годовая ставка:
            <span class="fw-semibold">
              {{ "%.3f"|format(result.equivalent.eq_rate) }} %
            </span>
          </p>
        {% endif %}

        <hr>

        <!-- Реальная ставка -->
        <form method="post">
          <input type="hidden" name="action" value="real">
          <h3 class="h6 mb-2">Реальная ставка</h3>
          <div class="mb-2">
            <label class="form-label">Номинальная ставка (% годовых)</label>
            <input type="number" step="0.01" name="rate_nominal_real" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Инфляция (% годовых)</label>
            <input type="number" step="0.01" name="inflation" class="form-control" required>
          </div>
          <button type="submit" class="btn btn-fb-outline w-100">
            Посчитать реальную ставку
          </button>
        </form>

        {% if result.real %}
          <p class="mb-1">
            Номинальная ставка: {{ "%.2f"|format(result.real.rate_nominal) }} %.
          </p>
          <p class="mb-1">
            Инфляция: {{ "%.2f"|format(result.real.inflation) }} %.
          </p>
          <p class="mb-0">
            Реальная ставка:
            <span class="fw-semibold">
              {{ "%.3f"|format(result.real.real_rate) }} %
            </span>
          </p>
        {% endif %}
      </div>
    </div>

    <!-- Кредит (аннуитет) -->
    <div class="col-md-12">
      <div class="fb-card p-4">
        <h2 class="h5 mb-3">Кредит (аннуитетный платёж)</h2>
        <form method="post" class="row g-3 mb-3">
          <input type="hidden" name="action" value="loan">
          <div class="col-md-3">
            <label class="form-label">Сумма кредита (₽)</label>
            <input type="number" step="0.01" name="principal_loan" class="form-control" required>
          </div>
          <div class="col-md-3">
            <label class="form-label">Ставка (% годовых)</label>
            <input type="number" step="0.01" name="rate_loan" class="form-control" required>
          </div>
          <div class="col-md-3">
            <label class="form-label">Срок (лет)</label>
            <input type="number" step="0.25" name="years_loan" class="form-control" required>
          </div>
          <div class="col-md-3 d-flex align-items-end">
            <button type="submit" class="btn btn-fb-primary w-100">
              Посчитать кредит
            </button>
          </div>
        </form>

        {% if result.loan %}
          <p class="mb-1">
            Кредит {{ result.loan.principal }} ₽ под
            {{ "%.2f"|format(result.loan.rate) }} % на {{ result.loan.years }} лет.
          </p>
          <ul class="mb-0">
            <li>Ежемесячный платёж: <strong>{{ "%.2f"|format(result.loan.payment) }} ₽</strong></li>
            <li>Всего будет выплачено: <strong>{{ "%.2f"|format(result.loan.total_paid) }} ₽</strong></li>
            <li>Переплата по процентам:
              <strong class="text-expense">{{ "%.2f"|format(result.loan.overpay) }} ₽</strong>
            </li>
          </ul>
        {% endif %}
      </div>
    </div>

  </div>
</div>
{% endblock %}
